<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crypto Dashboard</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background: #111;
      color: #eee;
    }
    h1 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      font-size: 0.9rem;
    }
    th, td {
      padding: 8px;
      text-align: right;
      border-bottom: 1px solid #444;
    }
    th {
      background-color: #222;
    }
    td.name, th.name {
      text-align: left;
    }
    .pos {
      color: #00ff99;
    }
    .neg {
      color: #ff5252;
    }
  </style>
</head>
<body>
  <h1>ü™ô Top 50 Cryptos</h1>
  <div id="summary"></div>
  <table id="crypto-table">
    <thead>
      <tr>
        <th>#</th>
        <th class="name">Name</th>
        <th>Price (USD)</th>
        <th>24h %</th>
        <th>ATH</th>
        <th>Drawdown</th>
        <th>Market Cap</th>
        <th>Volume 24h</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    async function loadCryptoData() {
      const url = 'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1&sparkline=false';

      try {
        const res = await fetch(url, {
          headers: {
            'User-Agent': 'Mozilla/5.0'
          }
        });
        const data = await res.json();

        const tbody = document.querySelector('#crypto-table tbody');
        tbody.innerHTML = '';

        data.forEach((coin, index) => {
          const price = coin.current_price ?? 0;
          const ath = coin.ath ?? 0;
          const drawdown = ath > 0 ? (((price - ath) / ath) * 100).toFixed(2) : 0;
          const change = coin.price_change_percentage_24h ?? 0;

          const row = `
            <tr>
              <td>${index + 1}</td>
              <td class="name">${coin.name} (${coin.symbol.toUpperCase()})</td>
              <td>$${price.toLocaleString()}</td>
              <td class="${change >= 0 ? 'pos' : 'neg'}">${change.toFixed(2)}%</td>
              <td>$${ath.toLocaleString()}</td>
              <td class="${drawdown >= 0 ? 'pos' : 'neg'}">${drawdown}%</td>
              <td>$${(coin.market_cap || 0).toLocaleString()}</td>
              <td>$${(coin.total_volume || 0).toLocaleString()}</td>
            </tr>
          `;
          tbody.insertAdjacentHTML('beforeend', row);
        });

        // AI-style summary (simple)
        const topGainer = data.reduce((a, b) => a.price_change_percentage_24h > b.price_change_percentage_24h ? a : b);
        const topLoser = data.reduce((a, b) => a.price_change_percentage_24h < b.price_change_percentage_24h ? a : b);
        const upCount = data.filter(c => c.price_change_percentage_24h > 0).length;
        const downCount = data.filter(c => c.price_change_percentage_24h < 0).length;

        document.getElementById('summary').innerHTML = `
          <p>üìä Market Sentiment: <strong>${upCount > downCount ? 'Bullish üìà' : 'Bearish üìâ'}</strong> ‚Äî ${upCount} up / ${downCount} down</p>
          <p>üöÄ Top Gainer: ${topGainer.name} (${topGainer.symbol.toUpperCase()}) +${topGainer.price_change_percentage_24h.toFixed(2)}%</p>
          <p>üìâ Top Loser: ${topLoser.name} (${topLoser.symbol.toUpperCase()}) ${topLoser.price_change_percentage_24h.toFixed(2)}%</p>
        `;
      } catch (err) {
        console.error('Failed to fetch data:', err);
        document.getElementById('summary').textContent = '‚ùå Failed to load market data.';
      }
    }

    loadCryptoData();
  </script>
</body>
</html>
